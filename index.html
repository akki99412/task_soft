<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>task_soft</title>

    <!-- jspreadsheet -->
    <script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script>
    <script src="https://jsuites.net/v4/jsuites.js"></script>
    <link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.css" type="text/css" />
    <link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Material+Icons" />
    <link rel="stylesheet" type="text/css"
        href="http://weareoutman.github.io/clockpicker/dist/jquery-clockpicker.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="http://weareoutman.github.io/clockpicker/dist/jquery-clockpicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"></script>
    <script>
        dayjs.extend(window.dayjs_plugin_utc);
        dayjs.extend(window.dayjs_plugin_timezone);
    </script>
    <link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.themes.css" type="text/css" />

    <!-- その他 -->
    <script src="keyFile.js" charset="UTF-8">
    </script>
    <script src="useCases/encrypt.js" charset="UTF-8">
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&display=swap" rel="stylesheet">

    <!-- frappe-gantt -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.5.0/frappe-gantt.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.6.0/frappe-gantt.min.js"></script>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="
        https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/darkly/bootstrap.min.css
        " rel="stylesheet">


    <!-- calendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script>


    </script>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>


    <!-- jkanban -->
    <!-- jKanban の .css ファイルを読み込む -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.css">
    <!-- jKanban の .js ファイルを読み込む -->
    <script src="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.js"></script>
    <link rel="stylesheet" href="jkanban.css">

    <!-- mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="dropdown" id="myDropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        data-bs-auto-close="outside" aria-expanded="false">
                        関係フィルター
                    </button>
                    <ul class="dropdown-menu">
                        <li><button class="dropdown-item" type="button" id="$connotativeTaskDropdownMenu">内包タスク</button>
                        </li>
                        <li><button class="dropdown-item" type="button" id="$dependencyTaskDropdownMenu">依存タスク</button>
                        </li>
                        <li><button class="dropdown-item" type="button" id="$successorTaskDropdownMenu">後続タスク</button>
                        </li>
                        <li><button class="dropdown-item disabled" type="button"
                                id="$similarTasksDropdownMenu">類似タスク</button>
                        </li>
                    </ul>
                </div>
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>
    <!-- <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.3.4/lib/darkmode-js.min.js"></script>
    <script>
        new Darkmode().showWidget();
    </script> -->
    <main class="container">
        <div id="filterTable"></div>
        <div id="spreadsheet"></div>
        <div class="mermaid" id="mermaidSvgContainer"></div>
        <div id="mermaidWorkingContainer"></div>
        <!-- <textarea id="svgCode"></textarea> -->
        <div id="svgContainer"></div>
        <div class='gantt-wrap gantt-target dark'>
            <svg class="gantt-target dark" id="gantt"></svg>
        </div>
        <div id='calendar'></div>

        <!-- ここにメッセージが表示される -->
        <!-- <div id="show-message">&nbsp;</div> -->

        <!-- ここにカンバンが表示される -->
        <div id="kanban-canvas"></div>
        <button type=button id="$saveButton">
            save
        </button>
        <button type=button id="$exportJsonButton">
            export JSON
        </button>
        <button type=button id="$importJsonButton">
            import JSON
        </button>
        <button type=button id="$loadButton">
            load
        </button>
        <div class="textarea">
            <textarea id="$textarea" cols="100" rows="50"></textarea>
        </div>

    </main>



    <script src="utilities/compose.js" charset="UTF-8"></script>
    <script src="utilities/pipe.js" charset="UTF-8"></script>
    <script src="utilities/utilities.js" charset="UTF-8"></script>
    <script src="utilities/timeline.js" charset="UTF-8"></script>
    <script src="utilities/DiContainer.js" charset="UTF-8"></script>
    <script src="utilities/elmLike.js" charset="UTF-8"></script>


    <script src="properties/constValues.js" charset="UTF-8"></script>
    <script src="properties/templateDataSource.js" charset="UTF-8"></script>

    <!-- <script src="repositories/secretKeyTimeline.js" charset="UTF-8"></script> -->
    <script src="useCases/useCases.js" charset="UTF-8"></script>
    <!-- <script src="timelines/timelines.js" charset="UTF-8"></script> -->

    <!-- <script src="views/repositoryView.js" charset="UTF-8"></script> -->
    <script src="views/table.js" charset="UTF-8"></script>
    <script src="views/calendar.js" charset="UTF-8"></script>
    <script src="views/gantt.js" charset="UTF-8"></script>
    <script src="views/kanban.js" charset="UTF-8"></script>
    <script src="views/treeGraph.js" charset="UTF-8"></script>
    <script src="views/filterTable.js" charset="utf-8"></script>

    <script src="elm/main.js" charset="UTF-8"></script>
    <script>
        console.groupCollapsed("test");
    </script>
    <script src="utilities/elmLike.test.js" charset="UTF-8"></script>
    <!-- <script src="repositories/localStrageGetter.js" charset="UTF-8"></script>
    <script src="repositories/localStrageSetter.js" charset="UTF-8"></script> -->


    <!-- <script src="preview/test.js" charset="UTF-8"></script>
    <script src="utilities/timeline.test.js" charset="UTF-8"></script> -->
    <script>
        console.groupEnd();
    </script>

    <script>

        $saveButton.onclick = function () {
            // clearTimeout(timeoutID);
            // c.log("timeoutID cleared")
            // delayRepositoryUpdate(repositories.value);
            main.update(new ButtonMessage({ id: $saveButton }));
        };
        $exportJsonButton.onclick = function () {
            // c.log(JSON.stringify(repositories.value));
            // $textarea.value = (JSON.stringify(repositories.value));
            main.update(new ButtonMessage({ id: $exportJsonButton }));
        };
        $importJsonButton.onclick = _ => {
            // repositorySetter.next(JSON.parse($json.value));
            // main.update(new ButtonMessage({id: $importJsonButton }));
            main.update(new ImportJsonMessage({ value: $textarea.value }))
        }

        $loadButton.onclick = function () {
            // clearTimeout(timeoutID);
            // c.log("timeoutID cleared")
            // getLocalStorage2Timeline(localStorageGetter);
            // repositorySetter.next(parseJson2repositories.value);

            main.update(new ButtonMessage({ id: $loadButton }));
            loadLocalStorage(secretKey)(main.update);
        };
        $connotativeTaskDropdownMenu.onclick = _ => {
            console.log($connotativeTaskDropdownMenu.id);
            main.update(new DropdownMenuMessage({ id: $connotativeTaskDropdownMenu.id }));
        }
        $dependencyTaskDropdownMenu.onclick = _ => {
            main.update(new DropdownMenuMessage({ id: $dependencyTaskDropdownMenu.id }));
        }
        $successorTaskDropdownMenu.onclick = _ => {
            main.update(new DropdownMenuMessage({ id: $successorTaskDropdownMenu.id }));
        }
        $similarTasksDropdownMenu.onclick = _ => {
            main.update(new DropdownMenuMessage({ id: $similarTasksDropdownMenu.id }));
        }
        $saveButton.onclick = function () {
            // clearTimeout(timeoutID);
            // c.log("timeoutID cleared")
            // delayRepositoryUpdate(repositories.value);
            main.update(new ButtonMessage({ id: $saveButton }));
        };
        const unloadFunction = e => {
            e.preventDefault();
            e.returnValue = "ページを離れようとしています。よろしいですか？"
        };
        saveTimeout.subscribe(value => {
            if (value.doneSave) {
                window.removeEventListener("beforeunload", unloadFunction);
            } else {
                window.addEventListener("beforeunload", unloadFunction);
            }
        });
        // const beforeUnloadTimeline = repositories.map(parent =>
        //     ({ isSaved: false })
        // );
        // loggerTimelines.push(
        //     beforeUnloadTimeline.map(a => { c.groupCollapsed("beforeUnloadTimeline"); c.log(a); c.groupEnd(); return a })
        // );

        // const beforeUnloadTimelineSetter = localStorageSetter.map(parent =>
        //     beforeUnloadTimeline.next({ isSaved: true })
        // );
        // loggerTimelines.push(
        //     beforeUnloadTimelineSetter.map(a => { c.groupCollapsed("beforeUnloadTimelineSetter"); c.log(a); c.groupEnd(); return a })
        // );

        // const beforeUnloadEventSetter = beforeUnloadTimeline.map(parent => {
        //     if (parent.isSaved) {
        //         window.removeEventListener("beforeunload", unloadFunction);
        //     } else {
        //         window.addEventListener("beforeunload", unloadFunction);
        //     }
        //     return parent.isSaved;
        // }
        // );
        // loggerTimelines.push(
        //     beforeUnloadEventSetter.map(a => { c.group("beforeUnloadEventSetter"); c.log(a); c.groupEnd(); return a })
        // );


    </script>
    <script>
        document.addEventListener("keydown", (e) => {
            // if (!e.repeat) {
            //     c.log(`Key "${e.key}" pressed [event: keydown]`);
            //     c.log(e);
            // } else {
            //     c.log(`Key "${e.key}" repeating [event: keydown]`);
            // }
            if (e.key === "z" && e.ctrlKey && !e.repeat) {
                e.preventDefault();
                main.update(new Undo());
            }
            if (e.key === "y" && e.ctrlKey && !e.repeat) {
                e.preventDefault();
                main.update(new Redo());
            }
        });

    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="gantt.css">
    <link href="navbar-fixed.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="calendar.css">
    <!-- <script type="text/javascript">
        hotkeys('ctrl+z,ctrl+y', function (event, handler) {
            switch (handler.key) {
                case 'ctrl+z': main.update(new Undo());
                    break;
                case 'ctrl+y': main.update(new Redo());
                    break;
                default: break;
            }
        });
    </script> -->
</body>

</html>